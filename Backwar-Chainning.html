<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sistem Pakar Diagnosa Penyakit Perokok — Backward Chaining (based on jurnal)</title>
<meta name="description" content="Expert System (Backward Chaining) — Diagnosa penyakit akibat rokok. Basis: CSRID Journal (Subagio et al., 2025)." />
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --accent:#2b6cb0;
    --muted:#6b7280;
    --ok:#117a65;
    --warn:#d97706;
    --danger:#b91c1c;
    --radius:12px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#eef2f7);padding:28px;color:#0b1220}
  .container{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:420px 1fr;gap:20px}
  header{grid-column:1 / -1;display:flex;align-items:center;gap:12px;margin-bottom:6px}
  .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#6ea8ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:20px;box-shadow:0 8px 20px rgba(43,108,176,0.12)}
  h1{margin:0;font-size:20px}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 8px 26px rgba(12,16,28,0.06)}
  .symptom-list{height:760px;overflow:auto;padding-right:6px}
  .symptom-item{display:flex;gap:12px;align-items:flex-start;padding:10px;border-radius:10px}
  .symptom-item:hover{background:#fbfdff}
  input[type=checkbox]{width:18px;height:18px;margin-top:3px}
  label{font-size:14px}
  .codes{margin-left:auto;color:var(--muted);font-size:12px;padding-top:2px}
  .controls{display:flex;gap:8px;margin-top:12px;align-items:center}
  .btn{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn.secondary{background:#eef2fb;color:var(--accent)}
  .steps{overflow:auto;height:520px;padding:10px;border-radius:10px;background:#fcfeff;border:1px dashed rgba(12,16,28,0.04)}
  .step{padding:10px;border-radius:10px;margin-bottom:10px;background:white;border:1px solid rgba(12,16,28,0.04)}
  .match{color:var(--ok);font-weight:700}
  .nomatch{color:var(--muted)}
  .conclusion{padding:12px;border-radius:10px;font-weight:700;margin-top:10px}
  .conclusion.ok{background:linear-gradient(90deg,#ecfdf5,#f0fdf4);color:var(--ok);border:1px solid rgba(17,122,101,0.06)}
  .conclusion.warn{background:linear-gradient(90deg,#fffaf0,#fff7ed);color:var(--warn);border:1px solid rgba(217,119,6,0.06)}
  .small{font-size:13px;color:var(--muted)}
  @media (max-width:980px){.container{grid-template-columns:1fr;padding:0 8px}.symptom-list{height:420px}.steps{height:360px}}
</style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div class="logo">KSR</div>
      <div>
        <h1>Sistem Pakar — Diagnosa Penyakit Perokok</h1>
        <p class="lead">Metode: <strong>Backward Chaining</strong> — Basis: CSRID Journal (Subagio et al., 2025).</p>
      </div>
    </header>

    <!-- LEFT: symptoms -->
    <aside class="card" aria-labelledby="symp-title">
      <h3 id="symp-title" style="margin:0 0 8px 0">Daftar Gejala (pilih yg dirasakan)</h3>
      <div class="small" style="margin-bottom:8px">Centang satu atau lebih gejala lalu tekan <strong>Diagnosa</strong>.</div>
      <div class="symptom-list" id="symptomList" aria-live="polite" tabindex="0"></div>

      <div class="controls">
        <button id="diagnoseBtn" class="btn">Diagnosa</button>
        <button id="clearBtn" class="btn secondary">Bersihkan</button>
        <div style="margin-left:auto" class="small">Rules: 5</div>
      </div>
    </aside>

    <!-- RIGHT: results -->
    <section class="card" aria-labelledby="result-title">
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
        <div style="flex:1">
          <h3 id="result-title" style="margin:0">Proses & Hasil</h3>
          <div class="small">Menelusuri setiap hipotesis penyakit lalu memeriksa fakta (gejala) — sesuai tabel aturan jurnal.</div>
        </div>
        <div style="width:220px">
          <div style="background:#f8fbff;padding:10px;border-radius:10px;border:1px solid rgba(43,108,176,0.06)">
            <div class="small">Diagnosa Terdeteksi</div>
            <div id="diagnosisSummary" style="font-weight:800;margin-top:6px">-</div>
            <div id="confSummary" class="small" style="margin-top:6px">Confidence: -</div>
          </div>
        </div>
      </div>

      <h4 style="margin:10px 0 8px 0">Langkah Penalaran (Backward Chaining)</h4>
      <div class="steps" id="steps"></div>

      <div id="finalBox" class="conclusion warn">Belum melakukan diagnosa. Pilih gejala lalu klik <strong>Diagnosa</strong>.</div>

      <div style="margin-top:12px" id="recommendations"></div>
    </section>
  </div>

<script>
/*
  Implementasi HTML/JS berdasarkan:
  - PDF: CSRID Journal — "Sistem Pakar Diagnosa Penyakit Perokok" (Subagio et al., 2025).
  - Rules (R01..R05) dan gejala (G01..G032) diambil sesuai tabel pada jurnal.
  - Metode: Backward Chaining (cek tiap hipotesis penyakit, cocokkan gejala).
  - Confidence level: (jumlah gejala cocok / total gejala penyakit) * 100%.
*/

/* ===========================
   GEJALA (dari Tabel 1)
   Kode persis seperti jurnal: G01..G032 (G010 used for 10)
============================= */
const gejalaList = [
  {code:"G01", text:"Adanya kerak atau keropeng pada tepi merah bibir"},
  {code:"G02", text:"Adanya penebalan atau adanya bercak putih pada mukosa bibir"},
  {code:"G03", text:"Adanya luka yang muncul pada bagian bawah lidah atau gusi"},
  {code:"G04", text:"Tumor terletak pada mukosa pipi"},
  {code:"G05", text:"Batuk disertai lendir berwarna kuning kehijauan"},
  {code:"G06", text:"Sakit pada tenggorokan"},
  {code:"G07", text:"Demam, berkeringat dan menggigil"},
  {code:"G08", text:"Nafsu makan menurun"},
  {code:"G09", text:"Demam"},
  {code:"G010", text:"Batuk berdarah"},
  {code:"G011", text:"Sulit bernapas"},
  {code:"G012", text:"Sesak dada dan kelelahan"},
  {code:"G013", text:"Sesak napas terutama saat aktivitas"},
  {code:"G014", text:"Bunyi mengi saat bernapas (napas berbunyi 'ngik-ngik')"},
  {code:"G015", text:"Batuk kering berkepanjangan"},
  {code:"G016", text:"Nyeri dada ketika menarik napas panjang"},
  {code:"G017", text:"Sering merasa kelelahan dan lemah"},
  {code:"G018", text:"Produksi dahak berlebihan di pagi hari"},
  {code:"G019", text:"Rasa nyeri dan panas di tenggorokan"},
  {code:"G020", text:"Suara serak atau hilang"},
  {code:"G021", text:"Tenggorokan terasa kering atau gatal"},
  {code:"G022", text:"Kesulitan menelan makanan atau minuman"},
  {code:"G023", text:"Batuk kering tanpa dahak"},
  {code:"G024", text:"Pembengkakan di area leher bawah (kelenjar getah bening)"},
  {code:"G025", text:"Nyeri dada seperti tertindih atau terbakar"},
  {code:"G026", text:"Sesak napas walau tidak beraktivitas berat"},
  {code:"G027", text:"Detak jantung tidak teratur atau berdebar cepat"},
  {code:"G028", text:"Nyeri menjalar ke bahu, leher, atau rahang"},
  {code:"G029", text:"Keringat dingin dan pucat"},
  {code:"G030", text:"Mudah lelah dan pusing"},
  {code:"G031", text:"Pembengkakan di kaki atau pergelangan"},
  {code:"G032", text:"Pingsan atau kehilangan kesadaran mendadak"}
];

/* ===========================
   RULES (dari Tabel 8) dan penyakit (K01..K05)
   R01..R05 sesuai jurnal
============================= */
const rules = [
  {id:"R01", if:["G01","G02","G03","G04"], then:{code:"K01", name:"Penyakit Mulut", total:4}},
  {id:"R02", if:["G05","G07","G010"], then:{code:"K02", name:"Penyakit Paru-paru", total:3}},
  {id:"R03", if:["G011","G013","G015"], then:{code:"K03", name:"Penyakit Pernapasan", total:3}},
  {id:"R04", if:["G06","G019","G020","G022"], then:{code:"K04", name:"Penyakit Tenggorokan", total:4}},
  {id:"R05", if:["G012","G025","G026","G027","G029","G030","G031","G032"], then:{code:"K05", name:"Penyakit Jantung", total:8}}
];

/* rekomendasi ringkas untuk tiap penyakit (bisa diedit) */
const recommendations = {
  K01: ["Segera periksakan ke dokter spesialis mulut/gigi.","Hindari merokok & konsultasi untuk pemeriksaan lesi (biopsi bila perlu).","Jaga kebersihan mulut dan kontrol rutin."],
  K02: ["Segera evaluasi oleh dokter paru.","Periksa rontgen/thoraks dan sputum jika batuk berdarah.","Berhenti merokok dan lakukan pemeriksaan lanjutan."],
  K03: ["Konsultasi ke dokter pernapasan/paru.","Evaluasi fungsi paru (spirometri) dan terapi suportif.","Hindari paparan asap dan polutan."],
  K04: ["Periksa ke dokter THT (telinga-hidung-tenggorokan).","Jika menelan sulit atau ada benjolan, lakukan pemeriksaan lebih lanjut.","Hentikan merokok dan rawat simptomatik."],
  K05: ["Segera ke unit gawat darurat jika nyeri dada hebat atau pingsan.","Evaluasi jantung (ECG, enzim jantung) oleh kardiolog.","Hentikan merokok dan kontrol faktor risiko kardiovaskular."]
};

/* ===========================
   Render checklist gejala
============================= */
const listEl = document.getElementById('symptomList');
gejalaList.forEach(g=>{
  const row = document.createElement('div');
  row.className = 'symptom-item';
  row.innerHTML = `
    <input id="${g.code}" type="checkbox" data-code="${g.code}" />
    <label for="${g.code}">${g.text}</label>
    <div class="codes">${g.code}</div>
  `;
  listEl.appendChild(row);
});

/* helper get checked */
function getChecked(){
  return Array.from(document.querySelectorAll('#symptomList input[type=checkbox]'))
    .filter(cb=>cb.checked).map(cb=>cb.dataset.code);
}

/* UI refs */
const stepsEl = document.getElementById('steps');
const diagnosisSummary = document.getElementById('diagnosisSummary');
const confSummary = document.getElementById('confSummary');
const finalBox = document.getElementById('finalBox');
const recommendationsEl = document.getElementById('recommendations');

/* run backward chaining (per rule: test if all IF facts present) */
function runBackwardChaining(){
  const WM = getChecked();
  stepsEl.innerHTML = '';
  diagnosisSummary.textContent = '-';
  confSummary.textContent = 'Confidence: -';
  finalBox.className = 'conclusion warn';
  finalBox.textContent = 'Menjalankan penalaran...';

  // For each hypothesis (rule), check how many conditions satisfied
  const traces = rules.map(rule=>{
    const matches = rule.if.map(cond => ({cond, present: WM.includes(cond)}));
    const matchedCount = matches.filter(m=>m.present).length;
    const confidence = (matchedCount / rule.then.total) * 100;
    return {rule, matches, matchedCount, confidence};
  });

  // render per-rule trace (backward style)
  traces.forEach(t=>{
    const el = document.createElement('div');
    el.className = 'step';
    const header = document.createElement('div');
    header.innerHTML = `<strong>${t.rule.id}</strong> — Hipotesis: <em>${t.rule.then.name}</em> (butuh ${t.rule.then.total} gejala)`;
    el.appendChild(header);

    const list = document.createElement('div');
    list.style.marginTop = '8px';
    list.innerHTML = t.matches.map(m=>{
      const txt = gejalaList.find(g=>g.code===m.cond)?.text || m.cond;
      return `<div style="display:flex;justify-content:space-between;padding:4px 0"><div>${m.cond} — ${txt}</div><div>${m.present ? '<span class="match">Ada ✓</span>' : '<span class="nomatch">Tidak ✓</span>'}</div></div>`;
    }).join('');
    el.appendChild(list);

    const foot = document.createElement('div');
    foot.style.marginTop = '8px';
    foot.innerHTML = `<div><strong>Matched:</strong> ${t.matchedCount}/${t.rule.then.total} — Confidence: <strong>${t.confidence.toFixed(1)}%</strong></div>`;
    el.appendChild(foot);

    stepsEl.appendChild(el);
  });

  // Determine best exact match (rule where matchedCount == total)
  const exact = traces.filter(t=>t.matchedCount === t.rule.then.total);
  if(exact.length > 0){
    // If multiple exact, list them; choose first as primary
    const primary = exact[0];
    diagnosisSummary.textContent = primary.rule.then.name + (exact.length>1 ? ' (multiple matches)' : '');
    confSummary.textContent = `Confidence: ${(primary.confidence).toFixed(1)}% (all symptoms matched)`;
    finalBox.className = 'conclusion ok';
    finalBox.innerHTML = `Diagnosis terdeteksi: <strong>${primary.rule.then.name}</strong> (aturan ${primary.rule.id}) — Confidence ${(primary.confidence).toFixed(1)}%`;

    // recommendations combined for all exact matches
    let recs = new Set();
    exact.forEach(e=> (recommendations[e.rule.then.code]||[]).forEach(r=>recs.add(r)));
    recommendationsEl.innerHTML = `<h4 style="margin:10px 0 6px 0">Rekomendasi awal</h4><ul>${Array.from(recs).map(r=>`<li>${r}</li>`).join('')}</ul>`;
    return;
  }

  // No exact match: find best by highest confidence
  let best = traces[0];
  traces.forEach(t => { if(t.confidence > best.confidence) best = t; });

  // Build summary
  if(best.matchedCount === 0){
    diagnosisSummary.textContent = 'Tidak cukup gejala untuk menyimpulkan';
    confSummary.textContent = 'Confidence: 0%';
    finalBox.className = 'conclusion warn';
    finalBox.innerHTML = 'Tidak ada hipotesis yang memiliki gejala yang cocok. Tambahkan lebih banyak gejala untuk diagnosa yang lebih akurat.';
    recommendationsEl.innerHTML = `<p class="small">Saran: jika merasakan gejala serius (nyeri dada hebat, pingsan, batuk berdarah, sesak napas berat), segera ke layanan kesehatan darurat.</p>`;
    return;
  }

  // Show best-match result with confidence %
  diagnosisSummary.textContent = `${best.rule.then.name} (Hipotesis: ${best.rule.id}) — ${best.matchedCount}/${best.rule.then.total} gejala`;
  confSummary.textContent = `Confidence: ${best.confidence.toFixed(1)}%`;

  finalBox.className = best.confidence >= 50 ? 'conclusion ok' : 'conclusion warn';
  finalBox.innerHTML = `Diagnosis paling mendekati: <strong>${best.rule.then.name}</strong><br>Matched: <strong>${best.matchedCount}/${best.rule.then.total}</strong> — Confidence <strong>${best.confidence.toFixed(1)}%</strong>`;

  // Provide recommendations (from best rule)
  const rec = recommendations[best.rule.then.code] || [];
  recommendationsEl.innerHTML = `<h4 style="margin:10px 0 6px 0">Rekomendasi awal</h4><ul>${rec.map(r=>`<li>${r}</li>`).join('')}</ul><p class="small">Catatan: Hasil ini bersifat indikatif. Untuk kepastian, konsultasikan ke tenaga medis.</p>`;
}

/* events */
document.getElementById('diagnoseBtn').addEventListener('click', runBackwardChaining);
document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.querySelectorAll('#symptomList input[type=checkbox]').forEach(cb=>cb.checked=false);
  stepsEl.innerHTML = '';
  diagnosisSummary.textContent = '-';
  confSummary.textContent = 'Confidence: -';
  finalBox.className = 'conclusion warn';
  finalBox.textContent = 'Belum melakukan diagnosa. Pilih gejala lalu klik Diagnosa.';
  recommendationsEl.innerHTML = '';
});
</script>
</body>
</html>
